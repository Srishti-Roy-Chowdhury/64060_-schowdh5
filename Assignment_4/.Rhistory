library(readr)
library(dplyr)
library(class)
library(gmodels)
library(tidyverse)
library(factoextra)
library(flexclust)
pharma <- read_csv("./Pharmaceuticals.csv")
#seperating numeric data
set.seed(135)
pharma.num <- pharma[, 3:11]
summary(pharma.num)
#This data is required normalization because the magnitude of Market_Cap is too high compare to other variables, which will influence the whole result.
#normalizing the data
pharma.num.scaled <- scale(pharma.num)
summary(pharma.num.scaled)    #now all the data normalized and almost in the same scale
#I am going to use the "Elbow method" and "Average Silhouette method" to find the best value for k
fviz_nbclust(pharma.num.scaled, kmeans, method="wss")  #Elbow method
#The elbow method suggests that the optimal number of clusters lies around 4, 5, or 6, because from 4 it started decreasing at a much smaller rate. In other words, k=4/5/6 provides the best value between bias and overfitting. However, the exact number of clusters remains somewhat ambiguous based on this method alone.
fviz_nbclust(pharma.num.scaled, kmeans, method="silhouette")  #Silhouette method
#On the other hand, the silhouette method provides a clearer indication, identifying k = 5 as the optimal cluster number. Compared to the elbow method, the silhouette approach is generally more reliable, objective, and easier to interpret. It not only evaluates how cohesive (tight) the clusters are internally but also how well-separated they are from each other.
#Therefore, I choose the k value 5
#visualizing the clusters
pharma.k <- kmeans(pharma.num.scaled,centers=5,nstart=25)
fviz_cluster(pharma.k, data=pharma.num.scaled)
#From the graph, it is clear that these five clusters are well defined and separated
#adding the cluster to the original dataset to summarize and find relation among cluster and variables
pharma$cluster <- pharma.k$cluster
#creating tables with mean values of all variables for each cluster
pharma.num.summary <- aggregate(pharma.num, by = list(Cluster = pharma$cluster), mean)
pharma.num.summary
#Cluster 1- medium market capital with moderate risk, revenue and low profit margin
#Cluster 2- low market capital with high revenue, high debt and good profit margin
#Cluster 3- large market capital with low risk, revenue but high profit margin
#Cluster 4- very low market capital with high risk, debt and low revenue and profit margin
#Cluster 5- largest market capital with low risk, debt and high revenue and highest profitability
#creating table to understand the distribution of these categorical variables within clusters
pharma %>% group_by(cluster,Median_Recommendation) %>% summarise(RecomC=n())
pharma %>% group_by(cluster,Location) %>% summarise(LocationC=n())
pharma %>% group_by(cluster,Exchange) %>% summarise(ExchangeC=n())
#Cluster 1- Canada, US based and mostly NYSE
#Cluster 2- moderate buy-sell and mostly NYSE
#Cluster 3- Mix reccomendation type, mostly US, NYSE
#Cluster 4- Mix of exchange type
#Cluster 5- Mostly US based and NYSE
#From my perspective I didn't find any specific pattern among those variables and clusters. But I have some general observation that most companies are Us-based and exchange type is NYSE accross the clusters. Most reccomendation variations are in Cluster 3 and most excange variations are in Cluster 4
#Naming the clusters corresponding the results of the variables representing growth, profit and risk, found in task-2
#Cluster 1- mediocre stable companies [moderate growth, moderate risk and revenue]
#Cluster 2- fast growing emerging companies [companies with high risk and high growth with decent profit]
#Cluster 3- profitable companies [low risk and low growth but highly profitable]
#Cluster 4- risky companies [low growth and low profit with high risk]
#Cluster 5- market dominating established companies [large growth and high profit with minimum risk]
